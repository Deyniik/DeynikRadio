<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Простой фоторедактор</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #4a6baf;
            margin-bottom: 10px;
        }
        
        .editor-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .image-container {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .btn {
            background-color: #4a6baf;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3a5a9f;
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        .control-group {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            color: #4a6baf;
        }
        
        .filter-btn {
            display: inline-block;
            width: 70px;
            height: 70px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            background-size: cover;
            background-position: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            transform: scale(1.05);
            border-color: #4a6baf;
        }
        
        .filter-btn.active {
            border-color: #4a6baf;
            box-shadow: 0 0 10px rgba(74, 107, 175, 0.5);
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .filter-presets {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            background-color: #4a6baf;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .file-label:hover {
            background-color: #3a5a9f;
        }
        
        .tools {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tool-btn {
            background-color: #f0f0f0;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tool-btn:hover {
            background-color: #e0e0e0;
        }
        
        .tool-btn.active {
            background-color: #4a6baf;
            color: white;
        }
        
        .download-btn {
            background-color: #28a745;
        }
        
        .download-btn:hover {
            background-color: #218838;
        }
        
        .reset-btn {
            background-color: #dc3545;
        }
        
        .reset-btn:hover {
            background-color: #c82333;
        }
        
        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-camera-retro"></i> Простой фоторедактор</h1>
            <p>Редактируйте ваши фотографии прямо в браузере</p>
        </header>
        
        <div class="editor-container">
            <div class="image-container">
                <input type="file" id="file-input" class="file-input" accept="image/*">
                <label for="file-input" class="file-label"><i class="fas fa-upload"></i> Загрузить фото</label>
                
                <div class="canvas-container">
                    <canvas id="canvas"></canvas>
                </div>
                
                <div class="tools">
                    <button class="btn tool-btn active" id="crop-btn" title="Обрезка"><i class="fas fa-crop"></i></button>
                    <button class="btn tool-btn" id="rotate-btn" title="Поворот"><i class="fas fa-sync-alt"></i></button>
                    <button class="btn tool-btn" id="flip-h-btn" title="Отразить по горизонтали"><i class="fas fa-arrows-alt-h"></i></button>
                    <button class="btn tool-btn" id="flip-v-btn" title="Отразить по вертикали"><i class="fas fa-arrows-alt-v"></i></button>
                    <button class="btn tool-btn" id="brightness-btn" title="Яркость"><i class="fas fa-sun"></i></button>
                    <button class="btn tool-btn" id="contrast-btn" title="Контраст"><i class="fas fa-adjust"></i></button>
                </div>
                
                <button class="btn download-btn" id="download-btn"><i class="fas fa-download"></i> Скачать</button>
                <button class="btn reset-btn" id="reset-btn"><i class="fas fa-undo"></i> Сбросить</button>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <h3><i class="fas fa-sliders-h"></i> Основные настройки</h3>
                    
                    <div class="slider-container">
                        <label for="brightness-slider">Яркость: <span id="brightness-value">0</span></label>
                        <input type="range" id="brightness-slider" min="-100" max="100" value="0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="contrast-slider">Контраст: <span id="contrast-value">0</span></label>
                        <input type="range" id="contrast-slider" min="-100" max="100" value="0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="saturation-slider">Насыщенность: <span id="saturation-value">0</span></label>
                        <input type="range" id="saturation-slider" min="-100" max="100" value="0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="hue-slider">Оттенок: <span id="hue-value">0</span></label>
                        <input type="range" id="hue-slider" min="0" max="360" value="0">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3><i class="fas fa-magic"></i> Фильтры</h3>
                    <div class="filter-presets">
                        <div class="filter-btn" data-filter="none" style="background-color: #f5f5f5;" title="Нет фильтра"></div>
                        <div class="filter-btn" data-filter="clarendon" style="background-color: #5b9fe3;" title="Clarendon"></div>
                        <div class="filter-btn" data-filter="gingham" style="background-color: #e8c8c8;" title="Gingham"></div>
                        <div class="filter-btn" data-filter="moon" style="background-color: #a5a5a5;" title="Moon"></div>
                        <div class="filter-btn" data-filter="lark" style="background-color: #f3e5d7;" title="Lark"></div>
                        <div class="filter-btn" data-filter="reyes" style="background-color: #f0d8b8;" title="Reyes"></div>
                        <div class="filter-btn" data-filter="juno" style="background-color: #e7bfab;" title="Juno"></div>
                        <div class="filter-btn" data-filter="slumber" style="background-color: #b5b8c3;" title="Slumber"></div>
                        <div class="filter-btn" data-filter="crema" style="background-color: #e4d4c8;" title="Crema"></div>
                        <div class="filter-btn" data-filter="ludwig" style="background-color: #e3d9d0;" title="Ludwig"></div>
                        <div class="filter-btn" data-filter="aden" style="background-color: #d3d9e7;" title="Aden"></div>
                        <div class="filter-btn" data-filter="perpetua" style="background-color: #c8d8b9;" title="Perpetua"></div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3><i class="fas fa-border-style"></i> Границы</h3>
                    <div class="filter-presets">
                        <div class="filter-btn" data-border="none" style="background-color: #f5f5f5;" title="Без рамки"></div>
                        <div class="filter-btn" data-border="white" style="background-color: white; border: 1px solid #ddd;" title="Белая рамка"></div>
                        <div class="filter-btn" data-border="black" style="background-color: black;" title="Черная рамка"></div>
                        <div class="filter-btn" data-border="vintage" style="background: linear-gradient(45deg, #f3e7e9, #e3eeff);" title="Винтажная рамка"></div>
                        <div class="filter-btn" data-border="polaroid" style="background-color: white; border-bottom: 30px solid white;" title="Полароид"></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="border-size-slider">Размер рамки: <span id="border-size-value">0</span>px</label>
                        <input type="range" id="border-size-slider" min="0" max="50" value="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Основные элементы
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const fileInput = document.getElementById('file-input');
            const downloadBtn = document.getElementById('download-btn');
            const resetBtn = document.getElementById('reset-btn');
            
            // Элементы управления
            const brightnessSlider = document.getElementById('brightness-slider');
            const contrastSlider = document.getElementById('contrast-slider');
            const saturationSlider = document.getElementById('saturation-slider');
            const hueSlider = document.getElementById('hue-slider');
            const borderSizeSlider = document.getElementById('border-size-slider');
            
            // Отображаемые значения
            const brightnessValue = document.getElementById('brightness-value');
            const contrastValue = document.getElementById('contrast-value');
            const saturationValue = document.getElementById('saturation-value');
            const hueValue = document.getElementById('hue-value');
            const borderSizeValue = document.getElementById('border-size-value');
            
            // Кнопки фильтров
            const filterButtons = document.querySelectorAll('.filter-btn[data-filter]');
            const borderButtons = document.querySelectorAll('.filter-btn[data-border]');
            
            // Состояние редактора
            let originalImage = null;
            let currentImage = null;
            let currentFilter = 'none';
            let currentBorder = 'none';
            let borderSize = 0;
            let rotation = 0;
            let isFlippedHorizontal = false;
            let isFlippedVertical = false;
            
            // Инициализация
            initCanvas();
            setupEventListeners();
            
            function initCanvas() {
                // Установка начального размера canvas
                canvas.width = 800;
                canvas.height = 600;
                
                // Отрисовка начального состояния
                drawInitialState();
            }
            
            function drawInitialState() {
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#999';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Загрузите изображение для редактирования', canvas.width / 2, canvas.height / 2);
            }
            
            function setupEventListeners() {
                // Загрузка изображения
                fileInput.addEventListener('change', handleImageUpload);
                
                // Скачивание изображения
                downloadBtn.addEventListener('click', downloadImage);
                
                // Сброс изменений
                resetBtn.addEventListener('click', resetImage);
                
                // Слайдеры
                brightnessSlider.addEventListener('input', updateBrightness);
                contrastSlider.addEventListener('input', updateContrast);
                saturationSlider.addEventListener('input', updateSaturation);
                hueSlider.addEventListener('input', updateHue);
                borderSizeSlider.addEventListener('input', updateBorderSize);
                
                // Фильтры
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentFilter = btn.dataset.filter;
                        applyFilters();
                    });
                });
                
                // Границы
                borderButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        borderButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentBorder = btn.dataset.border;
                        applyFilters();
                    });
                });
                
                // Инструменты
                document.getElementById('rotate-btn').addEventListener('click', rotateImage);
                document.getElementById('flip-h-btn').addEventListener('click', flipHorizontal);
                document.getElementById('flip-v-btn').addEventListener('click', flipVertical);
            }
            
            function handleImageUpload(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        originalImage = img;
                        currentImage = img;
                        drawImage();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            function drawImage() {
                if (!currentImage) return;
                
                // Очистка canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Рассчет размеров с учетом поворота
                let width, height;
                if (rotation === 90 || rotation === 270) {
                    width = currentImage.height;
                    height = currentImage.width;
                } else {
                    width = currentImage.width;
                    height = currentImage.height;
                }
                
                // Установка размеров canvas
                canvas.width = width;
                canvas.height = height;
                
                // Сохранение состояния контекста
                ctx.save();
                
                // Перемещение в центр canvas
                ctx.translate(canvas.width / 2, canvas.height / 2);
                
                // Поворот
                ctx.rotate(rotation * Math.PI / 180);
                
                // Отражаем изображение, если нужно
                ctx.scale(
                    isFlippedHorizontal ? -1 : 1,
                    isFlippedVertical ? -1 : 1
                );
                
                // Рисуем изображение
                ctx.drawImage(
                    currentImage,
                    -currentImage.width / 2,
                    -currentImage.height / 2,
                    currentImage.width,
                    currentImage.height
                );
                
                // Восстановление состояния контекста
                ctx.restore();
                
                // Применение фильтров
                applyFilters();
            }
            
            function applyFilters() {
                if (!currentImage) return;
                
                // Получаем текущие значения
                const brightness = parseInt(brightnessSlider.value);
                const contrast = parseInt(contrastSlider.value);
                const saturation = parseInt(saturationSlider.value);
                const hue = parseInt(hueSlider.value);
                
                // Создаем временный canvas для фильтров
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                
                // Копируем текущее изображение
                tempCtx.drawImage(canvas, 0, 0);
                
                // Применяем фильтры в зависимости от выбранного
                switch(currentFilter) {
                    case 'clarendon':
                        applyClarendonFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'gingham':
                        applyGinghamFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'moon':
                        applyMoonFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'lark':
                        applyLarkFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'reyes':
                        applyReyesFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'juno':
                        applyJunoFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'slumber':
                        applySlumberFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'crema':
                        applyCremaFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'ludwig':
                        applyLudwigFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'aden':
                        applyAdenFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                    case 'perpetua':
                        applyPerpetuaFilter(tempCtx, tempCanvas.width, tempCanvas.height);
                        break;
                }
                
                // Применяем базовые настройки
                applyBasicFilters(tempCtx, tempCanvas.width, tempCanvas.height, brightness, contrast, saturation, hue);
                
                // Очищаем основной canvas и рисуем отфильтрованное изображение
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(tempCanvas, 0, 0);
                
                // Применяем границы
                applyBorder();
            }
            
            function applyBasicFilters(ctx, width, height, brightness, contrast, saturation, hue) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                // Яркость
                if (brightness !== 0) {
                    const factor = 255 * (brightness / 100);
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] += factor;     // R
                        data[i + 1] += factor; // G
                        data[i + 2] += factor; // B
                    }
                }
                
                // Контраст
                if (contrast !== 0) {
                    const factor = (259 * (contrast + 255)) / (255 * (259 - contrast));
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = factor * (data[i] - 128) + 128;     // R
                        data[i + 1] = factor * (data[i + 1] - 128) + 128; // G
                        data[i + 2] = factor * (data[i + 2] - 128) + 128; // B
                    }
                }
                
                // Насыщенность и оттенок (более сложные вычисления)
                if (saturation !== 0 || hue !== 0) {
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        // Конвертация RGB в HSL
                        const hsl = rgbToHsl(r, g, b);
                        
                        // Изменение насыщенности
                        if (saturation !== 0) {
                            hsl.s = Math.min(1, Math.max(0, hsl.s + (saturation / 100)));
                        }
                        
                        // Изменение оттенка
                        if (hue !== 0) {
                            hsl.h = (hsl.h + (hue / 360)) % 1;
                            if (hsl.h < 0) hsl.h += 1;
                        }
                        
                        // Конвертация обратно в RGB
                        const rgb = hslToRgb(hsl.h, hsl.s, hsl.l);
                        data[i] = rgb.r;
                        data[i + 1] = rgb.g;
                        data[i + 2] = rgb.b;
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function rgbToHsl(r, g, b) {
                r /= 255, g /= 255, b /= 255;
                const max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                
                if (max === min) {
                    h = s = 0; // achromatic
                } else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                
                return { h, s, l };
            }
            
            function hslToRgb(h, s, l) {
                let r, g, b;
                
                if (s === 0) {
                    r = g = b = l; // achromatic
                } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1/6) return p + (q - p) * 6 * t;
                        if (t < 1/2) return q;
                        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                        return p;
                    };
                    
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1/3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1/3);
                }
                
                return {
                    r: Math.round(r * 255),
                    g: Math.round(g * 255),
                    b: Math.round(b * 255)
                };
            }
            
            // Фильтры Instagram-like
            function applyClarendonFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Увеличиваем контраст и насыщенность
                    data[i] = data[i] * 1.1;     // R
                    data[i + 1] = data[i + 1] * 1.05; // G
                    data[i + 2] = data[i + 2] * 0.95; // B
                    
                    // Добавляем легкий синий оттенок
                    data[i] = Math.min(255, data[i] * 0.95);
                    data[i + 1] = Math.min(255, data[i + 1] * 0.99);
                    data[i + 2] = Math.min(255, data[i + 2] * 1.08);
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyGinghamFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Уменьшаем насыщенность и добавляем винтажный эффект
                    const gray = 0.3 * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
                    data[i] = gray * 0.9 + data[i] * 0.1;     // R
                    data[i + 1] = gray * 0.9 + data[i + 1] * 0.1; // G
                    data[i + 2] = gray * 0.9 + data[i + 2] * 0.1; // B
                    
                    // Добавляем легкий розовый оттенок
                    data[i] = Math.min(255, data[i] * 1.05);
                    data[i + 1] = Math.min(255, data[i + 1] * 0.95);
                    data[i + 2] = Math.min(255, data[i + 2] * 0.95);
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyMoonFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Черно-белый с высоким контрастом
                    const gray = 0.3 * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
                    data[i] = data[i + 1] = data[i + 2] = gray > 128 ? 255 : 0;
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyLarkFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Увеличиваем яркость светлых участков
                    data[i] = Math.min(255, data[i] * 1.1);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 1.1); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 1.1); // B
                    
                    // Увеличиваем насыщенность
                    const max = Math.max(data[i], data[i + 1], data[i + 2]);
                    if (max === data[i]) data[i] = Math.min(255, data[i] * 1.05);
                    if (max === data[i + 1]) data[i + 1] = Math.min(255, data[i + 1] * 1.05);
                    if (max === data[i + 2]) data[i + 2] = Math.min(255, data[i + 2] * 1.05);
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyReyesFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Добавляем теплый оттенок
                    data[i] = Math.min(255, data[i] * 1.08);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 1.03); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 0.95); // B
                    
                    // Уменьшаем контраст
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    data[i] = avg * 0.3 + data[i] * 0.7;
                    data[i + 1] = avg * 0.3 + data[i + 1] * 0.7;
                    data[i + 2] = avg * 0.3 + data[i + 2] * 0.7;
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyJunoFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Добавляем розовый оттенок
                    data[i] = Math.min(255, data[i] * 1.05);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 0.95); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 0.95); // B
                    
                    // Увеличиваем насыщенность красных
                    if (data[i] > data[i + 1] && data[i] > data[i + 2]) {
                        data[i] = Math.min(255, data[i] * 1.1);
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applySlumberFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Уменьшаем насыщенность
                    const gray = 0.3 * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
                    data[i] = gray * 0.7 + data[i] * 0.3;     // R
                    data[i + 1] = gray * 0.7 + data[i + 1] * 0.3; // G
                    data[i + 2] = gray * 0.7 + data[i + 2] * 0.3; // B
                    
                    // Добавляем синий оттенок
                    data[i] = Math.min(255, data[i] * 0.95);
                    data[i + 1] = Math.min(255, data[i + 1] * 0.97);
                    data[i + 2] = Math.min(255, data[i + 2] * 1.05);
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyCremaFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Добавляем кремовый оттенок
                    data[i] = Math.min(255, data[i] * 1.03);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 1.02); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 0.98); // B
                    
                    // Уменьшаем контраст
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    data[i] = avg * 0.4 + data[i] * 0.6;
                    data[i + 1] = avg * 0.4 + data[i + 1] * 0.6;
                    data[i + 2] = avg * 0.4 + data[i + 2] * 0.6;
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyLudwigFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Увеличиваем яркость светлых участков
                    if (data[i] > 150 || data[i + 1] > 150 || data[i + 2] > 150) {
                        data[i] = Math.min(255, data[i] * 1.1);
                        data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                        data[i + 2] = Math.min(255, data[i + 2] * 1.1);
                    }
                    
                    // Добавляем легкий теплый оттенок
                    data[i] = Math.min(255, data[i] * 1.03);
                    data[i + 1] = Math.min(255, data[i + 1] * 1.01);
                    data[i + 2] = Math.min(255, data[i + 2] * 0.99);
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyAdenFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Добавляем зеленовато-голубой оттенок
                    data[i] = Math.min(255, data[i] * 0.95);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 1.02); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 1.03); // B
                    
                    // Уменьшаем насыщенность
                    const gray = 0.3 * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
                    data[i] = gray * 0.3 + data[i] * 0.7;
                    data[i + 1] = gray * 0.3 + data[i + 1] * 0.7;
                    data[i + 2] = gray * 0.3 + data[i + 2] * 0.7;
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyPerpetuaFilter(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // Добавляем пастельный оттенок
                    data[i] = Math.min(255, data[i] * 1.02);     // R
                    data[i + 1] = Math.min(255, data[i + 1] * 1.03); // G
                    data[i + 2] = Math.min(255, data[i + 2] * 1.01); // B
                    
                    // Уменьшаем контраст
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    data[i] = avg * 0.5 + data[i] * 0.5;
                    data[i + 1] = avg * 0.5 + data[i + 1] * 0.5;
                    data[i + 2] = avg * 0.5 + data[i + 2] * 0.5;
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            function applyBorder() {
                if (currentBorder === 'none' && borderSize === 0) return;
                
                ctx.save();
                
                // Размер границы
                const size = borderSize;
                
                // Цвет границы в зависимости от выбранного типа
                let borderColor;
                switch(currentBorder) {
                    case 'white':
                        borderColor = '#ffffff';
                        break;
                    case 'black':
                        borderColor = '#000000';
                        break;
                    case 'vintage':
                        // Градиент для винтажного эффекта
                        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                        gradient.addColorStop(0, '#f3e7e9');
                        gradient.addColorStop(1, '#e3eeff');
                        borderColor = gradient;
                        break;
                    case 'polaroid':
                        // Полароидная рамка (белая с нижней частью)
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        
                        // Добавляем место для подписи (нижняя часть)
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
                        return;
                    default:
                        borderColor = '#ffffff';
                }
                
                // Рисуем границу
                ctx.fillStyle = borderColor;
                ctx.fillRect(0, 0, canvas.width, size); // Верх
                ctx.fillRect(0, canvas.height - size, canvas.width, size); // Низ
                ctx.fillRect(0, 0, size, canvas.height); // Лево
                ctx.fillRect(canvas.width - size, 0, size, canvas.height); // Право
                
                ctx.restore();
            }
            
            function updateBrightness() {
                brightnessValue.textContent = brightnessSlider.value;
                applyFilters();
            }
            
            function updateContrast() {
                contrastValue.textContent = contrastSlider.value;
                applyFilters();
            }
            
            function updateSaturation() {
                saturationValue.textContent = saturationSlider.value;
                applyFilters();
            }
            
            function updateHue() {
                hueValue.textContent = hueSlider.value;
                applyFilters();
            }
            
            function updateBorderSize() {
                borderSize = parseInt(borderSizeSlider.value);
                borderSizeValue.textContent = borderSize;
                applyFilters();
            }
            
            function rotateImage() {
                rotation = (rotation + 90) % 360;
                drawImage();
            }
            
            function flipHorizontal() {
                isFlippedHorizontal = !isFlippedHorizontal;
                drawImage();
            }
            
            function flipVertical() {
                isFlippedVertical = !isFlippedVertical;
                drawImage();
            }
            
            function downloadImage() {
                if (!currentImage) return;
                
                const link = document.createElement('a');
                link.download = 'edited-image.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
            
            function resetImage() {
                if (!originalImage) return;
                
                // Сброс всех параметров
                currentImage = originalImage;
                currentFilter = 'none';
                currentBorder = 'none';
                borderSize = 0;
                rotation = 0;
                isFlippedHorizontal = false;
                isFlippedVertical = false;
                
                // Сброс слайдеров
                brightnessSlider.value = 0;
                contrastSlider.value = 0;
                saturationSlider.value = 0;
                hueSlider.value = 0;
                borderSizeSlider.value = 0;
                
                // Сброс отображаемых значений
                brightnessValue.textContent = '0';
                contrastValue.textContent = '0';
                saturationValue.textContent = '0';
                hueValue.textContent = '0';
                borderSizeValue.textContent = '0';
                
                // Сброс активных кнопок
                filterButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn[data-filter="none"]').classList.add('active');
                
                borderButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn[data-border="none"]').classList.add('active');
                
                // Перерисовка изображения
                drawImage();
            }
        });
    </script>
</body>
</html>
