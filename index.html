<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Deynik Music</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .video-card {
            cursor: pointer;
            transition: 0.3s;
            border-radius: 12px;
            background: transparent;
        }
        .video-card:hover .video-play-overlay { opacity: 1; }
        .video-thumbnail {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            background: #1a1a1a;
        }
        .video-thumbnail-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            z-index: 3;
        }
        .video-play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: 0.3s;
            z-index: 2;
        }
        .recommendation-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.2s;
            margin-bottom: 8px;
        }
        .recommendation-item:hover {
            background: #1a1a1a;
        }
        .recommendation-thumbnail {
            width: 120px;
            aspect-ratio: 16/9;
            border-radius: 6px;
            overflow: hidden;
            background: #1a1a1a;
            flex-shrink: 0;
        }
        .recommendation-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .recommendation-info {
            flex: 1;
        }
        .recommendation-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
        }
        .recommendation-artist {
            font-size: 12px;
            color: #7a7a7a;
        }
        #video-player::-webkit-media-controls {
            display: none !important;
        }
        #video-player {
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body>
    <header class="top-nav">
        <div class="logo-area" onclick="location.hash='#home'">
            <h1>Deynik Music</h1>
            <svg class="logo-svg" width="34" height="34" viewBox="0 0 100 100">
                <polygon points="12,12 75,50 12,88" fill="#CC6B26" rx="8" ry="8"/>
                <path d="M65,30 Q88,50 65,70 M78,15 Q110,50 78,85" stroke="#CC6B26" fill="none" stroke-width="8" stroke-linecap="round" transform="translate(5, 0)"/>
            </svg>
        </div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Поиск треков или исполнителей">
        </div>
        <div style="width: 380px;"></div>
    </header>

    <div class="app-main">
        <aside class="panel side">
            <div class="filter-nav">
                <div class="filter-scroll scroll-hide" id="filterScroll">
                    <button class="tab active" onclick="window.location.hash='#home'; filterSide('all', this)"><i data-lucide="home" size="16"></i></button>
                    <button class="tab" onclick="window.location.hash='#videos'; filterSide('all', this)">Видеоклипы</button>
                    <button class="tab" onclick="filterSide('artist', this)">Исполнители</button>
                    <button class="tab" onclick="filterSide('album', this)">Альбомы</button>
                    <button class="tab" onclick="filterSide('playlist', this)">Плейлисты</button>
                </div>
            </div>
            <div id="side-list" class="scroll-hide" style="overflow-y: auto;">
                <div class="side-item">
                    <div style="width:52px; height:52px; border-radius:6px; background: linear-gradient(135deg, #450af5, #c4efd9); display:flex; align-items:center; justify-content:center;">
                        <i data-lucide="heart" fill="white" color="white" size="24"></i>
                    </div>
                    <div style="margin-left:8px;"><b>Любимые треки</b><br><small style="color:#7a7a7a;">Плейлист • 0 треков</small></div>
                </div>
                <div id="filtered-content"></div>
                <div id="pinned-side-container" style="margin-top: 20px;"></div>
            </div>
        </aside>

        <main class="panel center scroll-hide" id="content-area"></main>

        <aside class="panel side">
            <img id="side-cover" src="" style="width:100%; border-radius:10px; margin-bottom:20px; display: none;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 id="side-title" style="font-size:24px; font-weight:800;">Выберите трек</h2>
                    <p id="side-artist" style="color:#7a7a7a; font-size:17px;"></p>
                </div>
                <i data-lucide="heart" id="like-side" class="like-btn" onclick="toggleLike()"></i>
            </div>
            <div style="margin-top:35px; display: flex; flex-direction: column; flex: 1; min-height: 0;">
                <p style="font-weight:700; margin-bottom:12px; font-size:12px; color:#7a7a7a; text-transform:uppercase;">Очередь</p>
                <div id="queue-list" class="scroll-hide" style="overflow-y: auto; flex: 1;"></div>
            </div>
        </aside>
    </div>

    <footer class="player-bar">
        <div style="display:flex; align-items:center; gap:15px; transform: translateY(-4px);">
            <img id="p-img" src="" style="width:58px; height:58px; border-radius:4px; background:#1a1a1a; display:none;">
            <div>
                <b id="p-title" style="font-size:15px; display:block; font-weight:600;">Выберите трек</b>
                <span id="p-artist" style="color:#7a7a7a; font-size:13px;"></span>
            </div>
            <i data-lucide="heart" id="like-player" size="20" class="like-btn" style="margin-left:20px;" onclick="toggleLike()"></i>
        </div>

        <div style="display:flex; flex-direction:column; align-items:center; gap:6px; transform: translateY(-4px);">
            <div style="display:flex; align-items:center; gap:20px;">
                <div class="p-btn" onclick="prevTrack()"><i data-lucide="skip-back" fill="white" size="18"></i></div>
                <div class="p-btn" style="background:white; color:black;" onclick="togglePlay()">
                    <i id="main-play-btn" data-lucide="play" fill="black" size="22" style="margin-left:2px;"></i>
                </div>
                <div class="p-btn" onclick="nextTrack()"><i data-lucide="skip-forward" fill="white" size="18"></i></div>
            </div>
            <div style="display:flex; align-items:center; gap:12px; width:100%; max-width:550px;">
                <span id="c-time" style="font-size:11px; color:#7a7a7a; width:35px;">0:00</span>
                <div class="bar-bg" onclick="seek(event)">
                    <div id="p-fill" class="bar-fill"></div>
                </div>
                <span id="d-time" style="font-size:11px; color:#7a7a7a; width:35px;">0:00</span>
            </div>
        </div>

        <div style="display:flex; justify-content:flex-end; align-items:center; transform: translateY(-4px);">
            <div style="display:flex; align-items:center; gap:12px;" onwheel="handleVolumeWheel(event)">
                <i data-lucide="volume-2" size="18" color="#7a7a7a"></i>
                <div class="vol-slider" id="vol-slider" onmousedown="startVolDrag(event)">
                    <div id="v-fill" class="vol-fill" style="width:70%;"></div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ========== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ==========
        window.albumTracks = [
            {title:"Disease", url:"https://s3.k-connect.ru/static/music/1475/5954/1770656682_Lady_Gaga_-_Disease.mp3", time:"3:50"},
            {title:"Abracadabra", url:"https://s3.k-connect.ru/static/music/1475/5955/1770656744_Lady_Gaga_-_Abracadabra.mp3", time:"3:43"},
            {title:"Garden Of Eden", url:"https://s3.k-connect.ru/static/music/1475/5956/1770656858_Lady_Gaga_-_Garden_Of_Eden.mp3", time:"3:59"},
            {title:"Perfect Celebrity", url:"https://s3.k-connect.ru/static/music/1475/5957/1770656859_Lady_Gaga_-_Perfect_Celebrity.mp3", time:"3:49"},
            {title:"Can't Stop the High", url:"https://s3.k-connect.ru/static/music/1475/5958/1770656859_Lady_Gaga_-_Can_t_Stop_the_High.mp3", time:"3:32"},
            {title:"Vanish Into You", url:"https://s3.k-connect.ru/static/music/1475/5959/1770656860_Lady_Gaga_-_Vanish_Into_You.mp3", time:"4:04"},
            {title:"Killah", url:"https://s3.k-connect.ru/static/music/1475/5960/1770656860_Lady_Gaga_-_Killah.mp3", time:"3:30"},
            {title:"Zombieboy", url:"https://s3.k-connect.ru/static/music/1475/5961/1770656861_Lady_Gaga_-_Zombieboy.mp3", time:"3:33"},
            {title:"The Dead Dance", url:"https://s3.k-connect.ru/static/music/1475/5962/1770656861_Lady_Gaga_-_The_Dead_Dance.mp3", time:"3:47"},
            {title:"LoveDrug", url:"https://s3.k-connect.ru/static/music/1475/5963/1770656862_Lady_Gaga_-_LoveDrug.mp3", time:"3:13"},
            {title:"How Bad Do U Want Me", url:"https://s3.k-connect.ru/static/music/1475/5964/1770656932_Lady_Gaga_-_How_Bad_Do_U_Want_Me.mp3", time:"3:58"},
            {title:"Don't Call Tonight", url:"https://s3.k-connect.ru/static/music/1475/5965/1770656932_Lady_Gaga_-_Don_t_Call_Tonight.mp3", time:"3:45"},
            {title:"Kill For Love", url:"https://s3.k-connect.ru/static/music/1475/5966/1770656933_Lady_Gaga_-_Kill_For_Love.mp3", time:"3:38"},
            {title:"Shadow Of A Man", url:"https://s3.k-connect.ru/static/music/1475/5967/1770656933_Lady_Gaga_-_Shadow_Of_A_Man.mp3", time:"3:19"},
            {title:"The Beast", url:"https://s3.k-connect.ru/static/music/1475/5968/1770656934_Lady_Gaga_-_The_Beast.mp3", time:"3:54"},
            {title:"Blade Of Grass", url:"https://s3.k-connect.ru/static/music/1475/5969/1770656934_Lady_Gaga_-_Blade_Of_Grass.mp3", time:"4:17"},
            {title:"Die With A Smile", url:"https://s3.k-connect.ru/static/music/1475/5970/1770656935_Lady_Gaga_-_Die_With_A_Smile.mp3", time:"4:11"}
        ];
        
        // ========== БАЗА ДАННЫХ ВИДЕО ==========
        window.videoDatabase = [
            {
                id: '22',
                title: '22',
                artist: 'Taylor Swift',
                duration: '3:52',
                videoUrl: 'https://s3.k-connect.ru/static/uploads/post/11561/FvHevpyAMu_Taylor_Swift_-_22_-_Taylor_Swift_1080p_h264.mp4',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11561/sddefault.jpg',
                avatar: 'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp',
                category: 'pop'
            },
            {
                id: 'opalite',
                title: 'Opalite',
                artist: 'Taylor Swift',
                duration: '4:15',
                videoUrl: 'https://s3.k-connect.ru/static/uploads/post/11560/UipqebVHl8_Taylor_Swift_-_Opalite_Official_Music_Video_-_Taylor_Swift_1080p_h264.mp4',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11560/maxresdefault.jpg',
                avatar: 'https://s3.k-connect.ru/static/uploads/post/11563/ZiWYMMBLcz_channels4_profile%20(1).webp',
                category: 'pop'
            },
            {
                id: 'abracadabra',
                title: 'Abracadabra',
                artist: 'Lady Gaga',
                duration: '3:43',
                videoUrl: 'https://s3.k-connect.ru/static/uploads/post/11559/ABInwxgnTA_Lady_Gaga_-_Abracadabra_Official_Music_Video_-_LadyGagaVEVO_1080p_h264_2.mp4',
                thumbnail: 'https://s3.k-connect.ru/static/uploads/comments/11559/maxresdefault_1.jpg',
                avatar: 'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg',
                category: 'pop'
            }
        ];

        // ========== СОСТОЯНИЕ ==========
        let audio = new Audio();
        let currentTracks = [];
        let currentIdx = -1;
        let isLiked = false;
        let isVolDragging = false;
        const albumCover = 'https://s3.k-connect.ru/static/music/1475/5955/1770656744_cover.jpeg';
        window.pinnedAlbum = null;
        window.trackLikes = {};
        window.videoLikes = {};
        window.currentVideoElement = null;
        window.isVideoPlaying = false;
        
        window.audio = audio;
        window.currentTracks = currentTracks;
        window.currentIdx = currentIdx;

        // ========== ЗАГРУЗКА КОНТЕНТА ==========
        async function loadContent() {
            let hash = location.hash.replace('#', '') || 'home';
            
            // ПРОВЕРЯЕМ: это страница видео?
            if (hash === 'videos') {
                await loadVideosPage();
            } 
            // ПРОВЕРЯЕМ: это страница отдельного видео?
            else if (hash.startsWith('video-')) {
                const videoId = hash.replace('video-', '');
                const video = window.videoDatabase.find(v => v.id === videoId);
                if (video) {
                    await loadVideoPage(video);
                } else {
                    location.hash = '#videos';
                }
            }
            else {
                // Обычная страница
                try {
                    const res = await fetch(`./pages/${hash}.html`);
                    let html = await res.text();
                    document.getElementById('content-area').innerHTML = html;
                    
                    const scripts = document.getElementById('content-area').getElementsByTagName('script');
                    for (let script of scripts) {
                        eval(script.innerHTML);
                    }
                    
                    lucide.createIcons();
                    
                    if (hash === 'home') {
                        renderPinnedInSide();
                        if (window.renderPinnedAlbum) {
                            setTimeout(window.renderPinnedAlbum, 50);
                        }
                    }
                } catch {
                    location.hash = '#home';
                }
            }
        }

        // ========== ЗАГРУЗКА СТРАНИЦЫ ВСЕХ ВИДЕО ==========
        async function loadVideosPage() {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = await generateVideosGrid();
            
            // Обновляем правую панель
            updateRightPanelForVideos();
            
            lucide.createIcons();
        }

        // ========== ЗАГРУЗКА СТРАНИЦЫ ОТДЕЛЬНОГО ВИДЕО ==========
        async function loadVideoPage(video) {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = await generateSingleVideoPage(video);
            
            // Автоматически запускаем видео
            setTimeout(() => {
                window.playVideo(
                    video.videoUrl,
                    video.title,
                    video.artist,
                    video.duration,
                    video.thumbnail,
                    video.avatar
                );
            }, 100);
            
            // Обновляем правую панель
            updateRightPanelForVideos(video);
            
            lucide.createIcons();
        }

        // ========== ГЕНЕРАЦИЯ СЕТКИ ВИДЕО ==========
        async function generateVideosGrid() {
            return `
                <div style="padding: 0; width: 100%;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
                        <div>
                            <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 8px;">Видеоклипы</h1>
                            <p style="color: #7a7a7a; font-size: 15px;">Смотри лучшие клипы в высоком качестве</p>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="document.getElementById('video-grid').classList.toggle('compact-view')">
                                <i data-lucide="layout-grid" size="20" color="white"></i>
                            </div>
                            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="window.sortVideos()">
                                <i data-lucide="arrow-up-down" size="20" color="white"></i>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
                        <button class="tab active" onclick="window.filterVideos('all', this)" style="background: white; color: black;">Все</button>
                        <button class="tab" onclick="window.filterVideos('pop', this)">Pop</button>
                    </div>

                    <div id="video-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;">
                        ${window.videoDatabase.map(video => `
                            <div class="video-card" data-category="${video.category}" onclick="window.location.hash='#video-${video.id}'">
                                <div class="video-thumbnail">
                                    <img src="${video.thumbnail}" class="video-thumbnail-img">
                                    <div class="video-duration">${video.duration}</div>
                                    <div class="video-play-overlay">
                                        <i data-lucide="play" size="40" color="white" fill="white"></i>
                                    </div>
                                </div>
                                <div style="display:flex; gap:12px; margin-top:12px;">
                                    <img src="${video.avatar}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                                    <div>
                                        <b style="font-size:15px;">${video.title}</b>
                                        <br>
                                        <small style="color:#7a7a7a;">${video.artist}</small>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ========== ГЕНЕРАЦИЯ СТРАНИЦЫ ОДНОГО ВИДЕО ==========
        async function generateSingleVideoPage(video) {
            return `
                <div style="padding: 0; width: 100%;">
                    <div style="margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="window.location.hash='#videos'">
                                <i data-lucide="arrow-left" size="20" color="white"></i>
                            </div>
                            <div>
                                <h1 style="font-size: 28px; font-weight: 800; margin-bottom: 4px;">${video.title}</h1>
                                <p style="color: #7a7a7a; font-size: 16px;">${video.artist}</p>
                            </div>
                            <div style="flex:1;"></div>
                            <div class="p-btn" style="width: 45px; height: 45px; background: #1a1a1a;" onclick="window.shareCurrentVideo()">
                                <i data-lucide="share-2" size="20" color="white"></i>
                            </div>
                        </div>
                        
                        <div id="video-player-section" style="width: 100%; margin-bottom: 30px;">
                            <div style="position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                                <video id="video-player" style="width: 100%; height: 100%;" src="${video.videoUrl}" playsinline></video>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== ОБНОВЛЕНИЕ ПРАВОЙ ПАНЕЛИ ДЛЯ ВИДЕО ==========
        function updateRightPanelForVideos(currentVideo = null) {
            const sidePanel = document.querySelector('.panel.side:last-child');
            if (!sidePanel) return;
            
            // Меняем заголовок
            const titleEl = sidePanel.querySelector('h2');
            if (titleEl) {
                titleEl.innerText = 'Смотрите так же';
                titleEl.style.fontSize = '24px';
                titleEl.style.fontWeight = '800';
            }
            
            // Убираем artist и cover
            const artistEl = document.getElementById('side-artist');
            if (artistEl) artistEl.style.display = 'none';
            
            const coverEl = document.getElementById('side-cover');
            if (coverEl) coverEl.style.display = 'none';
            
            // Убираем кнопку лайка
            const likeBtn = document.getElementById('like-side');
            if (likeBtn) likeBtn.style.display = 'none';
            
            // Получаем рекомендации
            let recommendations = [...window.videoDatabase];
            if (currentVideo) {
                recommendations = recommendations.filter(v => v.id !== currentVideo.id);
            }
            
            // Перемешиваем
            const shuffled = [...recommendations];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            const topRecs = shuffled.slice(0, 8);
            
            // Рендерим
            const container = sidePanel.querySelector('div:last-child > div:last-child');
            if (container) {
                container.innerHTML = `
                    <div id="queue-list" style="overflow-y: auto; flex: 1; padding-right: 5px;">
                        ${topRecs.map(video => `
                            <div class="recommendation-item" onclick="window.location.hash='#video-${video.id}'">
                                <div class="recommendation-thumbnail">
                                    <img src="${video.thumbnail}" loading="lazy">
                                </div>
                                <div class="recommendation-info">
                                    <span class="recommendation-title">${video.title}</span>
                                    <span class="recommendation-artist">${video.artist}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        // ========== ФУНКЦИИ ДЛЯ ВИДЕО ==========
        window.playVideo = function(videoUrl, title, artist, duration, coverArt, avatarUrl) {
            const videoElement = document.getElementById('video-player');
            if (!videoElement) return;
            
            videoElement.src = videoUrl;
            videoElement.play();
            
            window.currentVideoUrl = videoUrl;
            window.currentVideoTitle = title;
            window.currentVideoArtist = artist;
            window.currentVideoCover = coverArt;
            window.currentVideoAvatar = avatarUrl;
            window.currentVideoElement = videoElement;
            window.isVideoPlaying = true;
            
            // Обновляем нижний плеер
            document.getElementById('p-title').innerText = title;
            document.getElementById('p-artist').innerText = artist;
            document.getElementById('p-img').src = coverArt;
            document.getElementById('p-img').style.display = 'block';
            
            document.getElementById('main-play-btn')?.setAttribute('data-lucide', 'pause');
            
            // Прогресс бар
            videoElement.ontimeupdate = function() {
                if (videoElement.duration) {
                    const pct = (videoElement.currentTime / videoElement.duration) * 100 || 0;
                    document.getElementById('p-fill').style.width = pct + '%';
                    document.getElementById('c-time').innerText = formatTime(videoElement.currentTime);
                    document.getElementById('d-time').innerText = formatTime(videoElement.duration);
                }
            };
            
            // Перемотка
            const barBg = document.querySelector('.bar-bg');
            if (barBg) {
                barBg.onclick = function(e) {
                    if (videoElement.duration) {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const pct = (e.clientX - rect.left) / rect.width;
                        videoElement.currentTime = pct * videoElement.duration;
                    }
                };
            }
            
            // Громкость
            videoElement.volume = audio.volume;
            
            // Конец видео
            videoElement.onended = function() {
                window.playNextVideo();
            };
            
            lucide.createIcons();
        };

        // ========== ШЭР ВИДЕО ==========
        window.shareCurrentVideo = function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Ссылка на видео скопирована!');
            });
        };

        // ========== ФОРМАТ ВРЕМЕНИ ==========
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // ========== ПЕРЕОПРЕДЕЛЕНИЯ ==========
        window.togglePlay = function() {
            if (window.location.hash.startsWith('#video-') && window.currentVideoElement) {
                if (window.currentVideoElement.paused) {
                    window.currentVideoElement.play();
                    document.getElementById('main-play-btn')?.setAttribute('data-lucide', 'pause');
                } else {
                    window.currentVideoElement.pause();
                    document.getElementById('main-play-btn')?.setAttribute('data-lucide', 'play');
                }
                lucide.createIcons();
            } else {
                if (!audio.src) return;
                audio.paused ? audio.play() : audio.pause();
                if (window.currentTracks[window.currentIdx]) updateUI(window.currentTracks[window.currentIdx]);
            }
        };

        window.nextTrack = function() {
            if (window.location.hash.startsWith('#video-')) {
                const videos = window.videoDatabase;
                const currentIndex = videos.findIndex(v => v.videoUrl === window.currentVideoUrl);
                if (currentIndex < videos.length - 1) {
                    location.hash = `#video-${videos[currentIndex + 1].id}`;
                }
            } else {
                if (window.currentIdx < window.currentTracks.length - 1) {
                    window.playTrack(window.currentIdx + 1, window.currentTracks);
                }
            }
        };

        window.prevTrack = function() {
            if (window.location.hash.startsWith('#video-')) {
                const videos = window.videoDatabase;
                const currentIndex = videos.findIndex(v => v.videoUrl === window.currentVideoUrl);
                if (currentIndex > 0) {
                    location.hash = `#video-${videos[currentIndex - 1].id}`;
                }
            } else {
                if (window.currentIdx > 0) {
                    window.playTrack(window.currentIdx - 1, window.currentTracks);
                }
            }
        };

        // ========== ГРОМКОСТЬ ==========
        window.startVolDrag = function(e) {
            isVolDragging = true;
            updateVolumeFromEvent(e);
        };

        function updateVolumeFromEvent(e) {
            const rect = document.getElementById('vol-slider').getBoundingClientRect();
            let pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            
            if (window.location.hash.startsWith('#video-') && window.currentVideoElement) {
                window.currentVideoElement.volume = pct;
            }
            audio.volume = pct;
            document.getElementById('v-fill').style.width = (pct * 100) + '%';
        }

        window.handleVolumeWheel = function(e) {
            e.preventDefault();
            let newVol = audio.volume + (e.deltaY < 0 ? 0.05 : -0.05);
            newVol = Math.max(0, Math.min(1, newVol));
            
            if (window.location.hash.startsWith('#video-') && window.currentVideoElement) {
                window.currentVideoElement.volume = newVol;
            }
            audio.volume = newVol;
            document.getElementById('v-fill').style.width = (newVol * 100) + '%';
        };

        window.addEventListener('mousemove', (e) => { if (isVolDragging) updateVolumeFromEvent(e); });
        window.addEventListener('mouseup', () => { isVolDragging = false; });

        // ========== ФИЛЬТРАЦИЯ ВИДЕО ==========
        window.filterVideos = function(category, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const videos = document.querySelectorAll('.video-card');
            videos.forEach(video => {
                if (category === 'all') {
                    video.style.display = 'block';
                } else {
                    const videoCategory = video.getAttribute('data-category');
                    video.style.display = videoCategory === category ? 'block' : 'none';
                }
            });
        };

        // ========== СОРТИРОВКА ==========
        window.sortVideos = function() {
            const grid = document.getElementById('video-grid');
            const videos = Array.from(document.querySelectorAll('.video-card'));
            
            videos.sort((a, b) => {
                const titleA = a.querySelector('b')?.textContent || '';
                const titleB = b.querySelector('b')?.textContent || '';
                return titleA.localeCompare(titleB);
            });
            
            grid.innerHTML = '';
            videos.forEach(video => grid.appendChild(video));
            lucide.createIcons();
        };

        // ========== ЛАЙК ==========
        window.toggleLike = function() {
            if (window.location.hash.startsWith('#video-') && window.currentVideoUrl) {
                window.videoLikes[window.currentVideoUrl] = !window.videoLikes[window.currentVideoUrl];
                const isLiked = window.videoLikes[window.currentVideoUrl];
                
                document.querySelectorAll('.like-btn').forEach(el => {
                    el.classList.toggle('active', isLiked);
                    el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                    el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
                });
                
                lucide.createIcons();
            } else {
                if (!window.currentTracks.length) return;
                isLiked = !isLiked;
                document.querySelectorAll('.like-btn').forEach(el => {
                    el.classList.toggle('active', isLiked);
                    el.setAttribute('fill', isLiked ? '#CC6B26' : 'none');
                    el.setAttribute('color', isLiked ? '#CC6B26' : '#b3b3b3');
                });
                lucide.createIcons();
            }
        };

        // ========== ОСТАЛЬНЫЕ ФУНКЦИИ ==========
        function updateUI(track) {
            document.getElementById('p-title').innerText = track.title;
            document.getElementById('p-artist').innerText = 'Lady Gaga';
            document.getElementById('p-img').src = albumCover;
            document.getElementById('p-img').style.display = 'block';
            
            document.getElementById('side-cover').src = albumCover;
            document.getElementById('side-cover').style.display = 'block';
            document.getElementById('side-title').innerText = track.title;
            document.getElementById('side-artist').innerText = 'Lady Gaga';
            
            const icon = audio.paused ? 'play' : 'pause';
            document.getElementById('main-play-btn').setAttribute('data-lucide', icon);
            
            isLiked = false;
            document.querySelectorAll('.like-btn').forEach(el => {
                el.classList.remove('active');
                el.setAttribute('fill', 'none');
                el.setAttribute('color', '#b3b3b3');
            });
            
            lucide.createIcons();
        }

        window.playTrack = function(idx, trackList) {
            if (!trackList?.length) return;
            window.currentTracks = trackList;
            window.currentIdx = idx;
            const track = window.currentTracks[window.currentIdx];
            window.audio.src = track.url;
            window.audio.play();
            updateUI(track);
            renderQueue();
        };

        function renderQueue() {
            // ... существующая функция renderQueue ...
        }

        audio.ontimeupdate = function() {
            if (audio.duration && !window.location.hash.startsWith('#video-')) {
                const pct = (audio.currentTime / audio.duration) * 100 || 0;
                document.getElementById('p-fill').style.width = pct + '%';
                document.getElementById('c-time').innerText = formatTime(audio.currentTime);
                document.getElementById('d-time').innerText = formatTime(audio.duration);
            }
        };

        window.seek = function(e) {
            if (window.location.hash.startsWith('#video-') && window.currentVideoElement) {
                if (window.currentVideoElement.duration) {
                    const rect = e.currentTarget.getBoundingClientRect();
                    window.currentVideoElement.currentTime = ((e.clientX - rect.left) / rect.width) * window.currentVideoElement.duration;
                }
            } else if (audio.duration) {
                const rect = e.currentTarget.getBoundingClientRect();
                audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
            }
        };

        // ========== ЛЕВАЯ ПАНЕЛЬ ==========
        window.filterSide = function(type, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            renderSide(type);
        };

        function renderSide(filter) {
            const data = [
                { name: "Lady Gaga", sub: "Исполнитель", type: "artist" },
                { name: "Mayhem", sub: "Альбом • 2025", type: "album" }
            ];
            document.getElementById('filtered-content').innerHTML = data
                .filter(item => filter === 'all' || item.type === filter)
                .map(item => `
                    <div class="side-item" onclick="location.hash='#${item.type === 'album' ? 'mayhem' : ''}'">
                        <img src="${albumCover}" style="width:52px; height:52px; border-radius:4px;">
                        <div><b>${item.name}</b><br><small style="color:#7a7a7a;">${item.sub}</small></div>
                    </div>
                `).join('');
            
            renderPinnedInSide();
        }

        function renderPinnedInSide() {
            const container = document.getElementById('pinned-side-container');
            if (!container) return;
            
            if (window.pinnedAlbum) {
                container.innerHTML = `
                    <h3 style="font-size:14px; font-weight:700; margin:20px 0 15px; color:#7a7a7a; text-transform:uppercase;">Закреплено</h3>
                    <div class="side-item" onclick="location.hash='#mayhem'">
                        <img src="${window.pinnedAlbum.cover}" style="width:52px; height:52px; border-radius:4px;">
                        <div><b>${window.pinnedAlbum.name}</b><br><small style="color:#7a7a7a;">${window.pinnedAlbum.sub}</small></div>
                    </div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        window.renderPinnedInSide = renderPinnedInSide;

        // ========== СТАРТ ==========
        window.addEventListener('hashchange', loadContent);
        window.onload = () => {
            loadContent();
            renderSide('all');
            lucide.createIcons();
            audio.volume = 0.7;
        };
    </script>
</body>
</html>
