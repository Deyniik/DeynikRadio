<div class="gif-container">
    <div id="playback-indicator" class="playback-indicator"></div>
    <div id="gif-placeholder" class="gif-placeholder">
        <img id="mainGif" src="https://i.pinimg.com/originals/7d/04/0e/7d040e94931427709008aaeda14db9c8.gif" alt="Visualization GIF" style="width: 100%; height: 100%; object-fit: cover;">
    </div>
    
    <div id="visualization" class="visualization">
        <script>
            const visualization = document.getElementById('visualization');
            for (let i = 0; i < 60; i++) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                visualization.appendChild(bar);
            }
        </script>
    </div>

    <div class="now-playing">
        <h3 id="current-station-display">Deynik Radio</h3>
        <p>Сейчас играет: <span id="current-track">Неизвестно</span> - <span id="current-artist">Неизвестно</span></p>
    </div>

    <div id="heartEffect" class="heart-effect">
        <i class="fas fa-heart"></i>
        <div class="heart-text">Love!</div>
    </div>
</div>

<script>
    const sync = window.DeynikRadioSync;
    const mainGif = document.getElementById('mainGif');
    const playbackIndicator = document.getElementById('playback-indicator');

    function updateMainContentUI() {
        const state = sync.state;
        const station = sync.stations[state.stationId];

        // 1. Обновление GIF
        mainGif.src = station.gif;

        // 2. Обновление индикатора воспроизведения
        playbackIndicator.style.opacity = state.isPlaying ? 1 : 0;

        // 3. Обновление информации о треке
        document.getElementById('current-station-display').textContent = station.name;
        document.getElementById('current-track').textContent = station.currentTrack;
        document.getElementById('current-artist').textContent = station.currentArtist;
    }

    // Слушаем изменения состояния плеера и выбранной станции
    document.addEventListener('stateChanged', (e) => {
        if (e.detail.key === 'isPlaying') {
            playbackIndicator.style.opacity = e.detail.value ? 1 : 0;
        }
    });
    document.addEventListener('stationSelected', updateMainContentUI);
    
    // Инициализация
    updateMainContentUI();
</script>
